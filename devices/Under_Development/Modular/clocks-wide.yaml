select:
  - platform: template
    entity_category: config
    name: "Clock Style"
    id: clock_style
    icon: "mdi:clock-digital"
    optimistic: true
    restore_value: true
    options:
      - 7-segment
      - Flip
      - Default
      - Presence
      - Weather
      - Small
      - Analog
      - Wide
      - Alarmstyle
      - Big
    initial_option: Default
    on_value:
      - if:
          condition:
            lambda: return id(show_clock);
          then:
            - script.execute: show_clock_page

  - platform: template
    entity_category: config
    name: "Clock Wallpaper (Online)"
    id: clock_wallpaper_image
    icon: "mdi:image"
    optimistic: true
    restore_value: true
    options:
      - clock
      - hacker
      - mission
      - Rolex
      - starrysky
      - waves
      - tron
      - chip
    initial_option: ${clock_background_image}
    on_value:
      - online_image.set_url:
          id: clock_background
          url: !lambda |-
            std::string base = "https://github.com/RealDeco/xiaozhi-esphome/raw/main/images/Other/"
                               "${imagewidth}x${imageheight}/";
            return base + std::string(x) + ".png";
          update: true
      - script.execute: draw_display

script:
  - id: show_clock_page
    then:
      - lambda: |-
          const std::string sel = id(clock_style).state;
          if (sel == "Default") {
            id(main_display).show_page(default_clock);
          } else if (sel == "Flip") {
            id(main_display).show_page(flip_clock);
          } else if (sel == "Presence") {
            id(main_display).show_page(presence_sensor_clock);
          } else if (sel == "Weather") {
            id(main_display).show_page(weather_clock);
          } else if (sel == "Small") {
            id(main_display).show_page(small_clock);
          } else if (sel == "Analog") {
            id(main_display).show_page(analog_clock);
          } else if (sel == "Wide") {
            id(main_display).show_page(wide_clock);
          } else if (sel == "Alarmstyle") {
            id(main_display).show_page(alarmstyle_clock);
          } else if (sel == "Big") {
            id(main_display).show_page(big_clock);
          } else {
            id(main_display).show_page(clock_7segment);
          }
          id(main_display).update();

  - id: swipe_left_action   # next clock style
    then:
      - lambda: |-
          static const char* const opts[] = {
            "7-segment","Flip","Default","Presence","Weather","Small","Analog","Wide","Alarmstyle","Big"
          };
          const int N = sizeof(opts)/sizeof(opts[0]);
          std::string cur = id(clock_style).state.c_str();
          int idx = 0;
          for (int i = 0; i < N; i++) if (cur == opts[i]) { idx = i; break; }
          int next = (idx + 1) % N;
          id(clock_style).publish_state(opts[next]);
      - script.execute: show_clock_page

  - id: swipe_right_action  # previous clock style
    then:
      - lambda: |-
          static const char* const opts[] = {
            "7-segment","Flip","Default","Presence","Weather","Small","Analog","Wide","Alarmstyle","Big"
          };
          const int N = sizeof(opts)/sizeof(opts[0]);
          std::string cur = id(clock_style).state.c_str();
          int idx = 0;
          for (int i = 0; i < N; i++) if (cur == opts[i]) { idx = i; break; }
          int prev = (idx - 1 + N) % N;
          id(clock_style).publish_state(opts[prev]);
      - script.execute: show_clock_page

  - id: swipe_up_action     # next wallpaper (cycle)
    then:
      - lambda: |-
          static const char* const opts[] = { "clock","hacker","mission","Rolex","starrysky","waves","tron","chip" };
          const int N = sizeof(opts)/sizeof(opts[0]);
          std::string cur = id(clock_wallpaper_image).state.c_str();
          int idx = 0;
          for (int i = 0; i < N; i++) if (cur == opts[i]) { idx = i; break; }
          int next = (idx + 1) % N;
          id(clock_wallpaper_image).publish_state(opts[next]);
      - script.execute: draw_display

  - id: swipe_down_action   # toggle battery widget
    then:
      - switch.toggle: show_battery_status
      - script.execute: draw_display
